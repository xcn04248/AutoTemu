# CONSENSUS - AutoTemu 商品自动化上架系统

## 最终需求确认

基于用户需求和技术调研，以下是AutoTemu商品自动化上架系统的最终共识文档。

## 系统目标

开发一个自动化系统，从jp0663.com网站抓取商品信息，经过数据处理和转换后，自动上架到Temu日本站。

## 核心功能模块

### 1. 商品信息爬取模块
- **技术基础**：基于已有的Firecrawl实现（example/scrape_firecrawl.py）
- **抓取内容**：商品名称、价格、描述、图片链接、尺码信息、商品详情
- **输入参数**：单个商品URL
- **输出格式**：结构化JSON数据

### 2. 图片处理模块
- **OCR筛选**：使用百度OCR API识别并过滤包含中文的图片
- **图片要求**：
  - 尺寸：3:4比例，宽度≥1340px，高度≥1785px
  - 大小：≤2M
  - 格式：JPG/JPEG/PNG
- **处理流程**：下载→OCR检测→尺寸调整→格式转换→存储

### 3. 数据转换模块
- **价格处理**：原价 × 1.3（加价30%）
- **分类映射**：调用Temu API的category_recommend功能自动推荐类目
- **尺码映射**：
  - 建立标准尺码表（至少包含S、M、L三个码数）
  - 遵循Temu跳码规则
  - 将源网站尺码数据映射到Temu标准

### 4. Temu API集成模块
- **认证管理**：从.env文件读取API凭证
- **商品创建**：调用bg.local.goods.add接口
- **图片上传**：调用bg.local.goods.image.upload接口
- **错误处理**：API调用失败自动重试（最多3次）

### 5. 系统基础设施
- **配置管理**：使用.env文件管理敏感信息
- **日志系统**：记录各模块运行状态和错误信息
- **错误处理**：网络异常、API失败等情况的处理和重试

## 技术实现方案

### 架构设计
```
输入URL → 爬虫模块 → 数据清洗 → 图片处理 → 数据转换 → Temu API → 上架结果
            ↓           ↓           ↓           ↓           ↓
          日志记录    日志记录    日志记录    日志记录    日志记录
```

### 技术栈
- Python 3.8+
- Firecrawl（爬虫）
- 百度OCR API（图片文字识别）
- Temu API SDK（电商平台接口）
- Pillow（图片处理）
- requests（HTTP请求）
- python-dotenv（环境变量管理）
- logging（日志记录）

### 数据流规范

1. **爬虫输出格式**：
```json
{
    "productName": "商品名称",
    "price": 1000,
    "description": "商品描述",
    "imageLink": "主图URL",
    "sizes": [
        {"size": "S", "sizeImageLink": "尺码图URL"}
    ],
    "productDetails": {
        "details": "详细描述",
        "detailImageLinks": ["详情图URL1", "详情图URL2"]
    }
}
```

2. **Temu商品创建格式**：
```json
{
    "goodsBasic": {
        "goodsName": "商品名称",
        "catId": 12345,
        "hdThumbUrl": "主图URL",
        "carouselImageList": ["轮播图URLs"]
    },
    "goodsServicePromise": {...},
    "goodsProperty": {...},
    "skuList": [
        {
            "skuPrice": 1300,
            "skuQuantity": 100,
            "specList": [{"specId": 123, "specValue": "S"}]
        }
    ]
}
```

## 验收标准

1. **功能完整性**
   - ✓ 能够成功抓取jp0663.com的商品信息
   - ✓ 正确识别并过滤包含中文的图片
   - ✓ 价格自动加价30%
   - ✓ 自动推荐商品分类
   - ✓ 成功调用Temu API上架商品

2. **系统可靠性**
   - ✓ 网络异常时自动重试
   - ✓ API调用失败有详细错误日志
   - ✓ 数据验证确保必填字段完整

3. **代码质量**
   - ✓ 模块化设计，便于维护
   - ✓ 完善的错误处理机制
   - ✓ 详细的日志记录
   - ✓ 配置与代码分离

## 约束条件

1. **技术约束**
   - 必须使用Python venv虚拟环境
   - API密钥等敏感信息必须存储在.env文件中
   - 图片处理需符合Temu平台规范

2. **业务约束**
   - 仅支持单个商品URL处理
   - 上架失败的商品暂不做特殊处理
   - 当前仅支持jp0663.com网站

3. **扩展性考虑**
   - 数据源接口设计便于未来支持其他网站
   - 模块化架构便于功能扩展
   - 配置化管理便于适配不同市场

## 风险控制

1. **技术风险**
   - OCR识别准确率：通过人工复核机制补充
   - API限流：实现请求频率控制
   - 网络不稳定：实现断点续传机制

2. **业务风险**
   - 商品信息不完整：记录问题商品供人工处理
   - 分类推荐错误：提供手动指定分类选项

## 项目交付物

1. **源代码**
   - 完整的Python项目代码
   - 单元测试和集成测试

2. **文档**
   - API使用说明
   - 部署指南
   - 操作手册

3. **配置文件**
   - .env.example（环境变量模板）
   - requirements.txt（依赖列表）

## 确认声明

本共识文档已充分考虑用户需求和技术可行性，所有不确定性已通过沟通解决。系统设计遵循模块化、可扩展、易维护的原则，确保项目的成功交付和后续发展。
