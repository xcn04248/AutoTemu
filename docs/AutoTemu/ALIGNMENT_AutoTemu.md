# ALIGNMENT - AutoTemu 商品自动化上架系统

## 项目特性规范

### 技术栈
- **语言**: Python 3.8+
- **爬虫技术**: Firecrawl
- **OCR服务**: 百度OCR API
- **电商API**: Temu开发者API
- **依赖管理**: venv虚拟环境

### 现有资源
- **Firecrawl爬虫**: example/scrape_firecrawl.py（已实现商品信息抓取和OCR中文识别）
- **百度OCR API**: 已有API Key和Secret Key
- **Temu API SDK**: https://github.com/XIE7654/temu_api（需要集成）

## 原始需求

开发一个完整的自动化系统，用于从购物网站抓取商品并上架到Temu网店。系统需包含以下核心功能模块：

1. **商品信息爬取模块**
   - 基于已完成的Firecrawl技术实现
   - 确保能够稳定抓取商品标题、价格、描述等关键信息

2. **商品图片处理模块**
   - 对抓取的图片进行OCR识别处理
   - 自动筛选并移除所有包含中文字符的图片
   - 保留符合要求的商品主图和详情图

3. **商品上架模块**
   - 通过Temu API接口实现自动化上架
   - 完整实现商品上架功能
   - 确保与Temu网店系统的API对接稳定可靠

4. **系统要求**
   - 实现完善的错误处理机制
   - 建立完整的日志记录系统
   - 确保各模块间的数据格式统一
   - 系统需具备良好的扩展性

## 边界确认

### 包含范围
1. 爬虫模块的优化和封装
2. 图片OCR处理和筛选逻辑
3. Temu API集成和商品上架实现
4. 错误处理和重试机制
5. 日志系统实现
6. 数据格式标准化
7. 基本的配置管理系统

### 不包含范围
1. 图形界面（GUI）开发
2. 定时任务调度系统
3. 数据库持久化存储
4. 多商户管理功能
5. 商品价格动态调整策略
6. 反爬虫对抗机制

## 需求理解

### 对现有项目的理解
1. **Firecrawl爬虫已实现功能**：
   - 可以抓取指定URL的商品信息
   - 使用prompt方式提取结构化数据
   - 已集成百度OCR API进行中文识别
   - 实现了图片下载和分类存储

2. **需要改进的地方**：
   - 硬编码的URL需要参数化
   - OCR API密钥直接写在代码中，需要配置化
   - 缺少错误处理和重试机制
   - 没有模块化设计

### 技术集成要求
1. **Temu API集成**：
   - 需要App Key、App Secret和Access Token
   - 支持商品创建、SKU管理、图片上传等功能
   - 需要处理API认证和权限管理

2. **数据格式转换**：
   - 从爬虫数据格式转换为Temu API要求的格式
   - 处理图片URL到实际文件的转换
   - SKU属性映射和处理

## 疑问澄清

### 已确认项目

1. **Temu API认证信息**：
   - 所有API凭证存储在.env文件中
   - 目标站点：日本站

2. **商品数据映射**：
   - 价格策略：爬取价格的基础上加30%
   - 商品分类：使用Temu API的推荐分类功能（category_recommend）
   - 尺码映射：需要建立标准化尺码表，符合Temu规范

3. **图片处理策略**：
   - 移除包含中文的图片后，不强制最少图片数量
   - Temu图片要求：3:4比例，宽度≥1340px，高度≥1785px，大小≤2M
   - 每个SKC（款式颜色组合）建议5-10张图片

4. **系统运行方式**：
   - 单个商品URL处理模式
   - 不需要定期自动运行
   - 上架失败的商品暂不处理

5. **数据源网站**：
   - 当前仅支持jp0663.com
   - 设计时考虑未来扩展性

### 技术决策

1. **尺码表处理方案**：
   - 根据Temu要求，每个尺码表至少包含3个码数（如S、M、L）
   - 遵循跳码规则：XS到M胸围跳码4cm，M到XL跳码4-6cm，XL以后跳码6cm
   - 创建尺码映射字典，将源网站尺码转换为Temu标准

2. **图片处理流程**：
   - OCR识别→筛选非中文图片→尺寸检查→格式转换（如需要）
   - 保留原图和处理后的图片，便于追溯

3. **错误处理策略**：
   - 网络请求：3次重试，指数退避
   - API调用失败：记录详细错误信息
   - 数据验证：上架前进行完整性检查
